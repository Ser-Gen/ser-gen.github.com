<!doctype html>
<html class="noJS" lang="ru">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Погодник</title>
  <meta name="author" content="Васильев Сергей, веб-технолог">
  <meta name="description" content="Погодник — погодный подсказчик">
  <meta name="keywords" content="эксперимент, погодник, погодный помощник, geolocation, suncalc, google maps, geocoder">

  <!-- https://dev.twitter.com/docs/cards -->
  <meta name="twitter:creator" content="@Ser_Gen">
  <meta name="twitter:title" content="Погодник — погодный подсказчик">
  <meta name="twitter:description" content="Небольшой эксперимент с геокодированием, определением местонахождения, подгрузкой данных локально, определеним времени суток и погоды, подгрузкой шрифтов и многим другим.">
  <meta name="twitter:image" content="promo_120.png">

  <meta name="viewport" content="width=device-width, user-scalable=no">

  <!-- https://developers.google.com/fonts/docs/getting_started#Subsets -->
  <link href='http://fonts.googleapis.com/css?family=Lato:100' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Roboto:100&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  <!-- http://mathiasbynens.be/notes/touch-icons -->
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" id="favicon">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <style>
    .Attention {
      color: #000;
      margin: 3em 5em;
      width: 400px; /* возможно, такие пользователи по сей день сидят за совсем небольшими мониторами.. */
    }
    .Attention h1 {
      font-family: roboto, 'segoe ui', sans-serif;
      text-align: center;
    }
  </style>

<!-- Some IE crutches -->
<!--[if lte IE 8]>

</head>

<body>

  <div class="Attention" id="Attention">
    <h1>Пожалуйста, установите современный браузер</h1>
    <ul>
      <li><a href="http://www.google.ru/intl/ru/chrome/browser/">Хром</a></li>
      <li><a href="http://www.mozilla.org/ru/firefox/new/">Горящая лисица</a></li>
      <li><a href="http://windows.microsoft.com/ru-ru/internet-explorer/ie-10-worldwide-languages">Исследователь Интернета</a></li>
      <li><a href="http://browser.yandex.ru/">Яндекс.Обозреватель</a></li>
      <li><a href="http://www.opera.com/ru/">Опера</a></li>
    </ul>
  </div>
<![endif]-->

<!--[if (gt IE 8)|!(IE)]><!-->

  <link rel="stylesheet" href="css/loader.css">

</head>

<body>

  <div class="Loader">
    <div class="LoaderIcon"></div>
    <div class="LoaderText">Загрузка</div>
  </div>

  <div id="OverlayGradientHelper" class="OverlayGradient helper"></div>

  <div id="OverlayGradientMain" class="OverlayGradient">

    <div id="WeatherNow" class="Weather WeatherNow">
      <div class="WeatherIcon"></div>
      <div class="WeatherTemp"></div>
    </div>

    <div id="WeatherForecastHours" class="WeatherForecast hours">
      <div class="Weather">
        <div class="WeatherDate"></div>
        <div class="WeatherIcon"></div>
        <div class="WeatherTemp"></div>
      </div><div class="Weather">
        <div class="WeatherDate"></div>
        <div class="WeatherIcon"></div>
        <div class="WeatherTemp"></div>
      </div><div class="Weather">
        <div class="WeatherDate"></div>
        <div class="WeatherIcon"></div>
        <div class="WeatherTemp"></div>
      </div>
    </div>

    <div id="WeatherForecastDaily" class="WeatherForecast daily">
      <div class="Weather">
        <div class="WeatherDate"></div>
        <div class="WeatherIcon"></div>
        <div class="WeatherTemp"></div>
      </div><div class="Weather">
        <div class="WeatherDate"></div>
        <div class="WeatherIcon"></div>
        <div class="WeatherTemp"></div>
      </div><div class="Weather">
        <div class="WeatherDate"></div>
        <div class="WeatherIcon"></div>
        <div class="WeatherTemp"></div>
      </div>
    </div>

  </div>

  <div class="Address">
    <input class="AddressInput" type="text" id="address">
    <button class="AddressDetector" id="addressDetectAgain">
      <span class="AddressDetectorIcon"></span>
      <span class="AddressDetectorText">Найтись</span>
    </button>
  </div>



  <script>

    // http://stackoverflow.com/questions/1335851/what-does-use-strict-do-in-javascript-and-what-is-the-reasoning-behind-it
    'use strict';

    var d = document,
        w = window,
        head = d.getElementsByTagName('head')[0],
        body = d.body,
        // title = d.getElementsByTagName('title')[0],

        checkVW = d.createElement('div');
    checkVW.style.width = '100vw';
    body.appendChild(checkVW);

    d.getElementsByTagName("html")[0].className = '';

    if (checkVW.offsetWidth !== w.innerWidth) {
      loadCSS('css/mq_fallback.css');
    }

    // http://stackoverflow.com/questions/9197673/javascript-image-loader
    var files = {
          css : [
            'css/main.css'
          ],
          cssLoaded : 0,
          js : [
            // 'https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false',
            'js/geo.js',
            'js/suncalc.js',
            'js/main.js'
          ],
          jsLoaded : 0,
          image : [
            'img/states_day.png',
            'img/states_night.png'
          ],
          imagesLoaded : 0
        },
        countDataToLoad = 0,

        address = d.getElementById('address'),
        addressVal,
        addressDisabledDisabler;

    document.addEventListener("DOMContentLoaded", init, false);
    function init()
    {
      var images = [];
      var css = [];
      body.className = 'dataLoading';

      for(var i = 0, len = files.image.length; i < len; i++) {
        images[i] = loadImage(files.image[i]);
      }

      for(i = 0, len = files.css.length; i < len; i++) {
        css[i] = loadCSS(files.css[i]);
      }

      loadJS(files.js[files.jsLoaded]);
    }

    function loadImage(url)
    {
      var image = new Image();
      image.addEventListener("load", imageLoaded, false);
      image.src = url;
      return image;
    }
    function imageLoaded()
    {
      files.imagesLoaded++;
      if (files.imagesLoaded === files.image.length) {
        dataIsLoaded();
      }
    }

    // http://stackoverflow.com/questions/574944/how-to-load-up-css-files-using-javascript
    function loadCSS (url) {
      var link = d.createElement('link');
      link.rel  = 'stylesheet';
      link.href = url;
      head.appendChild(link);
    }

    // http://stackoverflow.com/questions/950087/how-to-include-a-javascript-file-in-another-javascript-file
    function loadJS (url) {
     var script = document.createElement('script');
     script.type = 'text/javascript';
     script.src = url;

     // then bind the event to the callback function 
     // there are several events for cross browser compatibility
     script.onreadystatechange = jsLoaded;
     script.onload = jsLoaded;

     // fire the loading
     head.appendChild(script);
    }
    function jsLoaded () {
      if (files.jsLoaded < files.js.length) {
        loadJS(files.js[files.jsLoaded]);
        files.jsLoaded++;
      }
      if (files.jsLoaded === files.js.length) {
        dataIsLoaded();
      }
    }

    function dataIsLoaded () {
      if (countDataToLoad > 2) {
            // && files.cssLoaded == files.css.length 
        if (files.imagesLoaded === files.image.length && files.jsLoaded === files.js.length) {
          body.className = 'dataLoaded';
          address.removeAttribute('disabled');
          clearTimeout(addressDisabledDisabler);
        }
      } else {
        countDataToLoad++;
      }
    }

  </script>

<!--<![endif]-->


<noscript>
  <div class="Attention">
    <h1>Пожалуйста, включите жабоскрипт.</h1>
  </div>
</noscript>

</body>
</html>
